---
import VariantButton from "@components/buttons/VariantButton.astro"
---

<section>
  <form id="egg-form-feedback">
    <label for="egg-form-feedback-input"><h2>FEEDBACK</h2></label>

    <div 
      class={`mt-3 border-2 rounded-lg p-2
        has-[:focus]:border-[var(--sl-color-accent)] has-[:focus]:dark:border-[var(--sl-color-accent-high)]
      `}
    >
      {/* Input */}
      <textarea
        name="feedback-input"
        id="egg-form-feedback-input"
        placeholder="Your feedback is anonymous ..."
        aria-placeholder="Share your feedback with us. It is anonymous"
        class={`w-full h-24 resize-none rounded-sm py-1 px-2
          bg-[var(--sl-color-black)] dark:bg-[var(--sl-color-gray-7)]
          focus:outline-none
        `}
      ></textarea>

      {/* Select and Submit Button */}
      <div class="flex justify-between items-end">
        <div class="grid">
          <label 
            for="egg-emoji-feeling-select" 
            class={`text-xs font-bold mb-1 text-[var(--sl-color-gray-3)]`}
          >RATE THE SITE</label>
          <select 
            name="emoji-feeling"
            id="egg-emoji-feeling-select"
            class={`bg-[var(--sl-color-gray-6)] py-2 px-3 rounded
              focus:ring focus:outline-none focus:ring-[var(--sl-color-accent)] focus:ring-offset-2 dark:focus:ring-offset-[var(--sl-color-gray-5)]
            `}
          >
            <option value="">â­</option>
            <option value="very-good">ğŸ”¥ Very Good</option>
            <option value="good">ğŸ˜ƒ Good</option>
            <option value="fair">ğŸ˜ Fair</option>
            <option value="bad">â˜¹ï¸ Bad</option>
            <option value="very-bad">ğŸ˜¡ Very Bad</option>
          </select>
        </div>
        <VariantButton
          icon="telegram"
          theme="simple"
          variant="primary"
          classes="h-10"
          buttonLabel="submit the feedback from the feedback form"
          iconLabel="submit feedback"
        />
      </div>
    </div>
    <form>
</section>

<script>
import { db } from "@firebase/client";
import { addDoc, collection, serverTimestamp } from "firebase/firestore";

const feedbackForm = document.getElementById("egg-form-feedback") as HTMLFormElement;
const feedbackFormInput = document.getElementById("egg-form-feedback-input") as HTMLInputElement;
const feedbackFormEmoji = document.getElementById("egg-emoji-feeling-select") as HTMLSelectElement; 

feedbackForm.onsubmit = async (event) => {
  event.preventDefault();

  const feedback = new FormData(feedbackForm);
  const feedbackInput = feedback.get("feedback-input");
  const emojiFeeling = feedback.get("emoji-feeling");

  const collRef = collection(db, "feedback");

  try {
    await addDoc(collRef, {
      feedback: feedbackInput, 
      emoji: emojiFeeling,
      createdAt: serverTimestamp()
    });
    resetFormAndThankUser();
  } catch (error) {
    console.log(error);
  }

  // TODO: if the value subimitted is empty or the emoji feeling is empty
};

function resetFormAndThankUser() {
  feedbackFormInput.value = "";
  feedbackFormEmoji.value= "";
  feedbackFormInput.placeholder = "Thank You for your feedback :)";
  setTimeout(() => {
    feedbackFormInput.placeholder = "Your feedback is anonymous ...";
  } , 3000);
}
</script>
